<!doctype html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Flot Charts | Notika - Notika Admin Template</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- favicon
		============================================ -->
    <link rel="shortcut icon" type="image/x-icon" href="/static/img/favicon.ico">
    <!-- Google Fonts
		============================================ -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900" rel="stylesheet">
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <!-- font awesome CSS
		============================================ -->
    <link rel="stylesheet" href="/static/css/font-awesome.min.css">
    <!-- owl.carousel CSS
		============================================ -->
    <link rel="stylesheet" href="/static/css/owl.carousel.css">
    <link rel="stylesheet" href="/static/css/owl.theme.css">
    <link rel="stylesheet" href="/static/css/owl.transitions.css">
    <!-- meanmenu CSS
		============================================ -->
    <link rel="stylesheet" href="/static/css/meanmenu/meanmenu.min.css">
    <!-- animate CSS
		============================================ -->
    <link rel="stylesheet" href="/static/css/animate.css">
    <!-- normalize CSS
		============================================ -->
    <link rel="stylesheet" href="/static/css/normalize.css">
	<!-- wave CSS
		============================================ -->
    <link rel="stylesheet" href="/static/css/wave/waves.min.css">
    <link rel="stylesheet" href="/static/css/wave/button.css">
    <!-- mCustomScrollbar CSS
		============================================ -->
    <link rel="stylesheet" href="/static/css/scrollbar/jquery.mCustomScrollbar.min.css">
    <!-- Notika icon CSS
		============================================ -->
    <link rel="stylesheet" href="/static/css/notika-custom-icon.css">
    <!-- main CSS
		============================================ -->
    <link rel="stylesheet" href="/static/css/main.css">
    <!-- style CSS
		============================================ -->
    <link rel="stylesheet" href="/static/style.css">
    <!-- responsive CSS
		============================================ -->
    <link rel="stylesheet" href="/static/css/responsive.css">
    <!-- modernizr JS
		============================================ -->
    <script src="/static/js/vendor/modernizr-2.8.3.min.js"></script>


    <style>
      .flot-chart-wp {
        padding: 20px 10px;
        text-align: center;
        margin-bottom: 40px;
      }
    
      .chart-block {
        max-width: 600px;
        margin: auto;
      }
    
      .dropdown {
        margin-bottom: 10px;
      }
    
      .section-divider {
        height: 15px;
      }
    
      .flot-chart-area {
        padding-top: 15px;
        padding-bottom: 15px;
      }
    </style>

</head>

<body>
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    {% include "header.html" %}
	<!-- Breadcomb area Start-->
	<div class="breadcomb-area">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
					<div class="breadcomb-list">
						<div class="row">
							<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
								<div class="breadcomb-wp">
									<div class="breadcomb-icon">
										<i class="notika-icon notika-bar-chart"></i>
									</div>
									<div class="breadcomb-ctn">
										<h2>상관관계 그래프</h2>
										<p>일교차와 대기오염 <span class="bread-ntd"></span></p>
									</div>
								</div>
							</div>
							<div class="col-lg-6 col-md-6 col-sm-6 col-xs-3">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Breadcomb area End-->


  <!-- Chart area Start-->
<div class="flot-chart-area">
  <div class="container">

    <!-- 1~2 줄 -->
    <div class="row">
      <!-- heatmap-chart -->
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="flot-chart-wp">
          <div id="heatmap-chart" class="chart-block"></div>
        </div>
      </div>
      <!-- heatmap-chart1 -->
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="flot-chart-wp">
          <div class="dropdown">
            <select id="diseaseSelector1" class="form-control" style="max-width: 300px; margin: auto;">
              <option value="cold">감기</option>
              <option value="asthma">천식</option>
            </select>
          </div>
          <div id="heatmap-chart1" class="chart-block"></div>
        </div>
      </div>
    </div>

    <div class="section-divider"></div>

    <!-- 3~4 줄 -->
    <div class="row">
      <!-- heatmap-chart2 -->
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="flot-chart-wp">
          <div class="dropdown">
            <select id="coldLagSelector" class="form-control" style="max-width: 300px; margin: auto;">
              <option value="cold_lag0">감기_lag0</option>
              <option value="cold_lag1">감기_lag1</option>
              <option value="cold_lag2">감기_lag2</option>
              <option value="cold_lag3">감기_lag3</option>
              <option value="cold_lag4">감기_lag4</option>
              <option value="cold_lag5">감기_lag5</option>
            </select>
          </div>
          <div id="heatmap-chart2" class="chart-block"></div>
        </div>
      </div>
      <!-- heatmap-chart3 -->
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="flot-chart-wp">
          <div class="dropdown">
            <select id="asthmaLagSelector" class="form-control" style="max-width: 300px; margin: auto;">
              <option value="asthma_lag0">천식_lag0</option>
              <option value="asthma_lag1">천식_lag1</option>
              <option value="asthma_lag2">천식_lag2</option>
              <option value="asthma_lag3">천식_lag3</option>
              <option value="asthma_lag4">천식_lag4</option>
              <option value="asthma_lag5">천식_lag5</option>
            </select>
          </div>
          <div id="heatmap-chart3" class="chart-block"></div>
        </div>
      </div>
    </div>

    <div class="section-divider"></div>

    <!-- 5~6 줄 -->
    <div class="row">
      <!-- heatmap-chart4 -->
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="flot-chart-wp">
          <div class="dropdown">
            <select id="eyedisLagSelector" class="form-control" style="max-width: 300px; margin: auto;">
              <option value="eyedis_lag0">눈병_lag0</option>
              <option value="eyedis_lag1">눈병_lag1</option>
              <option value="eyedis_lag2">눈병_lag2</option>
              <option value="eyedis_lag3">눈병_lag3</option>
              <option value="eyedis_lag4">눈병_lag4</option>
              <option value="eyedis_lag5">눈병_lag5</option>
            </select>
          </div>
          <div id="heatmap-chart4" class="chart-block"></div>
        </div>
      </div>
      <!-- heatmap-chart5 -->
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="flot-chart-wp">
          <div class="dropdown">
            <select id="dermatiLagSelector" class="form-control" style="max-width: 300px; margin: auto;">
              <option value="dermati_lag0">피부염_lag0</option>
              <option value="dermati_lag1">피부염_lag1</option>
              <option value="dermati_lag2">피부염_lag2</option>
              <option value="dermati_lag3">피부염_lag3</option>
              <option value="dermati_lag4">피부염_lag4</option>
              <option value="dermati_lag5">피부염_lag5</option>
            </select>
          </div>
          <div id="heatmap-chart5" class="chart-block"></div>
        </div>
      </div>
    </div>

    <div class="section-divider"></div>

    <!-- 7~8 줄 -->
    <div class="row">
      <!-- bar-corr-chart -->
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="flot-chart-wp">
          <!-- 기존 드롭다운 자리에 오염물질 단일선택 체크박스 삽입 -->
          <div style="text-align: center; margin-bottom: 10px;">
            {% for pollutant in pollutant_corr.keys() %}
              <label style="margin-right: 10px;">
                <input type="checkbox" name="pollutantToggle" value="{{ pollutant }}" {% if loop.first %}checked{% endif %}>
                {{ pollutant }}
              </label>
            {% endfor %}
          </div>
          <div id="bar-corr-chart" class="chart-block"></div>
        </div>
      </div>
      <!-- boxplot-chart1 (같은 row 안에 col-6으로 위치) -->
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="flot-chart-wp">
            <h2 class="title" style="font-size: 18px;">감기 vs 이산화질소 농도 구간에 따른 발생건수 분포</h2>
            <div id="boxplot-chart1" class="chart-block"></div>
        </div>
      </div>
    </div>

  </div>
</div>
<!-- Chart area End-->


    <!-- Start Footer area-->
    <div class="footer-copyright-area">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="footer-copy-right">
                        <p>Copyright © 2018 
. All rights reserved. Template by <a href="https://colorlib.com">Colorlib</a>.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Footer area-->
    <!-- jquery
		============================================ -->
    <script src="/static/js/vendor/jquery-1.12.4.min.js"></script>
    <!-- bootstrap JS
		============================================ -->
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- wow JS
		============================================ -->
    <script src="/static/js/wow.min.js"></script>
    <!-- price-slider JS
		============================================ -->
    <script src="/static/js/jquery-price-slider.js"></script>
    <!-- owl.carousel JS
		============================================ -->
    <script src="/static/js/owl.carousel.min.js"></script>
    <!-- scrollUp JS
		============================================ -->
    <script src="/static/js/jquery.scrollUp.min.js"></script>
    <!-- meanmenu JS
		============================================ -->
    <script src="/static/js/meanmenu/jquery.meanmenu.js"></script>
    <!-- counterup JS
		============================================ -->
    <script src="/static/js/counterup/jquery.counterup.min.js"></script>
    <script src="/static/js/counterup/waypoints.min.js"></script>
    <script src="/static/js/counterup/counterup-active.js"></script>
    <!-- mCustomScrollbar JS
		============================================ -->
    <script src="/static/js/scrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <!-- sparkline JS
		============================================ -->
    <script src="/static/js/sparkline/jquery.sparkline.min.js"></script>
    <script src="/static/js/sparkline/sparkline-active.js"></script>
    <!-- flot JS
		============================================ -->
    <script src="/static/js/flot/jquery.flot.js"></script>
    <script src="/static/js/flot/jquery.flot.resize.js"></script>
    <script src="/static/js/flot/jquery.flot.pie.js"></script>
    <script src="/static/js/flot/jquery.flot.tooltip.min.js"></script>
    <script src="/static/js/flot/jquery.flot.orderBars.js"></script>
    <script src="/static/js/flot/curvedLines.js"></script>
    <script src="/static/js/flot/flot-active.js"></script>
    <!-- knob JS
		============================================ -->
    <script src="/static/js/knob/jquery.knob.js"></script>
    <script src="/static/js/knob/jquery.appear.js"></script>
    <script src="/static/js/knob/knob-active.js"></script>
    <!--  Chat JS
		============================================ -->
    <script src="/static/js/chat/jquery.chat.js"></script>
    <!--  todo JS
		============================================ -->
    <script src="/static/js/todo/jquery.todo.js"></script>
	<!--  wave JS
		============================================ -->
    <script src="/static/js/wave/waves.min.js"></script>
    <script src="/static/js/wave/wave-active.js"></script>
    <!-- plugins JS
		============================================ -->
    <script src="/static/js/plugins.js"></script>
    <!-- main JS
		============================================ -->
    <script src="/static/js/main.js"></script>
	<!-- tawk chat JS
		============================================ -->
    <script src="/static/js/tawk-chat.js"></script>


  <!-- apexcharts CDN 추가 -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <!-- Plotly 라이브러리 불러오기 -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <!-- 교체: 최신 버전 명시 (예: v2.27.0 기준) -->
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

</body>


{% block js_block %}

<!-- [1] heatmap-chart: 고정 히트맵 (기본 상관관계) -->
<script>
  const xLabels = {{ x_labels | tojson | safe }};
  const yLabels = {{ y_labels | tojson | safe }};
  const zValues = {{ z_values | tojson | safe }};

  const annotations = [];
  for (let i = 0; i < yLabels.length; i++) {
    for (let j = 0; j < xLabels.length; j++) {
      annotations.push({
        x: xLabels[j],
        y: yLabels[i],
        text: String(zValues[i][j]),
        font: { size: 12, color: 'black' },
        showarrow: false
      });
    }
  }

  const layout = {
    title: {
      text: '감기/천식/일교차 상관관계 히트맵(당일진료기준)',
      font: { size: 20, family: 'Roboto, sans-serif', color: '#333' }
    },
    margin: { l: 100, r: 50, b: 50, t: 80 },
    xaxis: { side: 'bottom' },
    yaxis: {},
    annotations: annotations
  };

  const data = [{
    z: zValues,
    x: xLabels,
    y: yLabels,
    type: 'heatmap',
    colorscale: [
      [0.00, '#f0fdfb'],
      [0.25, '#a9eee2'],
      [0.50, '#63dfc9'],
      [0.75, '#1dd0b0'],
      [1.00, '#04c394']
    ],
    showscale: true
  }];

  Plotly.newPlot('heatmap-chart', data, layout);
</script>

<!-- [2] heatmap-chart1: 드롭다운 감기/천식 선택 -->
<script>
  const heatmapData = {
    cold: {{ cold_corr | tojson | safe }},
    asthma: {{ asthma_corr | tojson | safe }}
  };

  const axisLabels = {
    cold: {{ cold_axis_labels | tojson | safe }},
    asthma: {{ asthma_axis_labels | tojson | safe }}
  };

  function updateHeatmap1(disease) {
    const z = heatmapData[disease];
    const labels = axisLabels[disease];  // ✅ 병렬적으로 라벨 변경
    const annotations = [];

    for (let i = 0; i < labels.length; i++) {
      for (let j = 0; j < labels.length; j++) {
        annotations.push({
          x: labels[j],
          y: labels[i],
          text: !isNaN(parseFloat(z[i][j])) ? parseFloat(z[i][j]).toFixed(2) : '',
          font: { size: 12, color: 'black' },
          showarrow: false
        });
      }
    }

    const trace = {
      z: z,
      x: labels,
      y: labels,
      type: 'heatmap',
      colorscale: [
        [0.00, '#f0fdfb'],
        [0.25, '#a9eee2'],
        [0.50, '#63dfc9'],
        [0.75, '#1dd0b0'],
        [1.00, '#04c394']
      ],
      showscale: true
    };

    const layout = {
      title: {
        text: (disease === 'cold' ? '감기' : '천식') + ' 일교차 상관관계 히트맵',
        font: { size: 20, color: '#333' }
      },
      margin: { l: 150, r: 50, b: 120, t: 80 },  // 마진 조금 넉넉하게
      xaxis: {
        side: 'bottom',
        tickangle: -45,
        tickfont: { size: 10 },
        automargin: true
      },
      yaxis: {
        tickfont: { size: 10 },
        automargin: true
      },
      annotations: annotations
    };


    Plotly.react('heatmap-chart1', [trace], layout);
  }

  // 초기 렌더링
  updateHeatmap1('cold');

  // 드롭다운 이벤트 연결
  document.getElementById("diseaseSelector1").addEventListener("change", function () {
    updateHeatmap1(this.value);
  });
</script>




<!-- [3] heatmap-chart2: 감기+lag 선택 드롭다운 -->
<script>
  const coldLagData = {
    cold_lag0: {{ cold_lag0 | tojson | safe }},
    cold_lag1: {{ cold_lag1 | tojson | safe }},
    cold_lag2: {{ cold_lag2 | tojson | safe }},
    cold_lag3: {{ cold_lag3 | tojson | safe }},
    cold_lag4: {{ cold_lag4 | tojson | safe }},
    cold_lag5: {{ cold_lag5 | tojson | safe }}
  };
  const cold_axis_labels = {{ cold_axis_labels | tojson | safe }};

  function updateHeatmap2(lag) {
    const z = coldLagData[lag];
    const annotations = [];
    for (let i = 0; i < cold_axis_labels.length; i++) {
      for (let j = 0; j < cold_axis_labels.length; j++) {
        annotations.push({
          x: cold_axis_labels[j],
          y: cold_axis_labels[i],
          text: typeof z[i][j] === 'number' ? z[i][j].toFixed(2) : '',
          font: { size: 10, color: 'black' },
          showarrow: false
        });
      }
    }

    const layout = {
      title: {
        text: lag + ' 대기오염 상관 히트맵',
        font: { size: 20, color: '#333' }
      },
      margin: { l: 150, r: 50, b: 120, t: 80 },
      xaxis: {
        side: 'bottom',
        tickangle: -45,
        tickfont: { size: 10 },
        automargin: true
      },
      yaxis: {
        tickfont: { size: 10 },
        automargin: true
      },
      annotations: annotations
    };

    Plotly.newPlot('heatmap-chart2', [{
      z: z,
      x: cold_axis_labels,
      y: cold_axis_labels,
      type: 'heatmap',
      colorscale: [
        [0.00, '#f0fdfb'],
        [0.25, '#a9eee2'],
        [0.50, '#63dfc9'],
        [0.75, '#1dd0b0'],
        [1.00, '#04c394']
      ],
      showscale: true,
      zauto: true,
      zmin: -1,
      zmax: 1
    }], layout);
  }

  document.addEventListener("DOMContentLoaded", function () {
    updateHeatmap2('cold_lag0');
    document.getElementById("coldLagSelector").addEventListener("change", function () {
      updateHeatmap2(this.value);
    });
  });
</script>

<!-- [4] heatmap-chart3: 천식+lag 선택 드롭다운 -->
<script>
  const asthmaLagData = {
    asthma_lag0: {{ asthma_lag0 | tojson | safe }},
    asthma_lag1: {{ asthma_lag1 | tojson | safe }},
    asthma_lag2: {{ asthma_lag2 | tojson | safe }},
    asthma_lag3: {{ asthma_lag3 | tojson | safe }},
    asthma_lag4: {{ asthma_lag4 | tojson | safe }},
    asthma_lag5: {{ asthma_lag5 | tojson | safe }},
    asthma_lag6: {{ asthma_lag6 | tojson | safe }}
  };
  const asthma_axis_labels = {{ asthma_axis_labels | tojson | safe }};

  function updateHeatmap3(lag) {
    const z = asthmaLagData[lag];
    const annotations = [];
    for (let i = 0; i < asthma_axis_labels.length; i++) {
      for (let j = 0; j < asthma_axis_labels.length; j++) {
        annotations.push({
          x: asthma_axis_labels[j],
          y: asthma_axis_labels[i],
          text: typeof z[i][j] === 'number' ? z[i][j].toFixed(2) : '',
          font: { size: 10, color: 'black' },
          showarrow: false
        });
      }
    }

    const layout = {
      title: {
        text: lag + ' 대기오염 상관 히트맵',
        font: { size: 20, color: '#333' }
      },
      margin: { l: 150, r: 50, b: 120, t: 80 },
      xaxis: {
        side: 'bottom',
        tickangle: -45,
        tickfont: { size: 10 },
        automargin: true
      },
      yaxis: {
        tickfont: { size: 10 },
        automargin: true
      },
      annotations: annotations
    };

    Plotly.newPlot('heatmap-chart3', [{
      z: z,
      x: asthma_axis_labels,
      y: asthma_axis_labels,
      type: 'heatmap',
      colorscale: [
        [0.00, '#f0fdfb'],
        [0.25, '#a9eee2'],
        [0.50, '#63dfc9'],
        [0.75, '#1dd0b0'],
        [1.00, '#04c394']
      ],
      showscale: true,
      zauto: true,
      zmin: -1,
      zmax: 1
    }], layout);
  }

  document.addEventListener("DOMContentLoaded", function () {
    updateHeatmap3('asthma_lag0');
    document.getElementById("asthmaLagSelector").addEventListener("change", function () {
      updateHeatmap3(this.value);
    });
  });
</script>

<!--  [5] heatmap-chart4: 눈병+lag 선택 드롭다운 (예정 - 병명/lag 처리용) -->
<script>
  const eyedisLagData = {
    eyedis_lag0: {{ eyedis_lag0 | tojson | safe }},
    eyedis_lag1: {{ eyedis_lag1 | tojson | safe }},
    eyedis_lag2: {{ eyedis_lag2 | tojson | safe }},
    eyedis_lag3: {{ eyedis_lag3 | tojson | safe }},
    eyedis_lag4: {{ eyedis_lag4 | tojson | safe }},
    eyedis_lag5: {{ eyedis_lag5 | tojson | safe }},
    eyedis_lag6: {{ eyedis_lag6 | tojson | safe }}
  };
  const eyedis_axis_labels = {{ eyedis_axis_labels | tojson | safe }};

  function updateHeatmap4(lag) {
    const z = eyedisLagData[lag];
    const annotations = [];
    for (let i = 0; i < eyedis_axis_labels.length; i++) {
      for (let j = 0; j < eyedis_axis_labels.length; j++) {
        annotations.push({
          x: eyedis_axis_labels[j],
          y: eyedis_axis_labels[i],
          text: typeof z[i][j] === 'number' ? z[i][j].toFixed(2) : '',
          font: { size: 10, color: 'black' },
          showarrow: false
        });
      }
    }

    const layout = {
      title: {
        text: lag + ' 대기오염 상관 히트맵',
        font: { size: 20, color: '#333' }
      },
      margin: { l: 150, r: 50, b: 120, t: 80 },
      xaxis: {
        side: 'bottom',
        tickangle: -45,
        tickfont: { size: 10 },
        automargin: true
      },
      yaxis: {
        tickfont: { size: 10 },
        automargin: true
      },
      annotations: annotations
    };

    Plotly.newPlot('heatmap-chart4', [{
      z: z,
      x: eyedis_axis_labels,
      y: eyedis_axis_labels,
      type: 'heatmap',
      colorscale: [
        [0.00, '#f0fdfb'],
        [0.25, '#a9eee2'],
        [0.50, '#63dfc9'],
        [0.75, '#1dd0b0'],
        [1.00, '#04c394']
      ],
      showscale: true,
      zauto: true,
      zmin: -1,
      zmax: 1
    }], layout);
  }

  document.addEventListener("DOMContentLoaded", function () {
    updateHeatmap4('eyedis_lag0');
    document.getElementById("eyedisLagSelector").addEventListener("change", function () {
      updateHeatmap4(this.value);
    });
  });
</script>

<!--  [6] heatmap-chart5: 피부염+lag 선택 드롭다운 (예정 - 병명/lag 처리용) -->
<script>
  const dermatiLagData = {
    dermati_lag0: {{ dermati_lag0 | tojson | safe }},
    dermati_lag1: {{ dermati_lag1 | tojson | safe }},
    dermati_lag2: {{ dermati_lag2 | tojson | safe }},
    dermati_lag3: {{ dermati_lag3 | tojson | safe }},
    dermati_lag4: {{ dermati_lag4 | tojson | safe }},
    dermati_lag5: {{ dermati_lag5 | tojson | safe }},
    dermati_lag6: {{ dermati_lag6 | tojson | safe }}
  };
  const dermati_axis_labels = {{ dermati_axis_labels | tojson | safe }};

  function updateHeatmap5(lag) {
    const z = dermatiLagData[lag];
    const annotations = [];
    for (let i = 0; i < dermati_axis_labels.length; i++) {
      for (let j = 0; j < dermati_axis_labels.length; j++) {
        annotations.push({
          x: dermati_axis_labels[j],
          y: dermati_axis_labels[i],
          text: typeof z[i][j] === 'number' ? z[i][j].toFixed(2) : '',
          font: { size: 10, color: 'black' },
          showarrow: false
        });
      }
    }

    const layout = {
      title: {
        text: lag + ' 대기오염 상관 히트맵',
        font: { size: 20, color: '#333' }
      },
      margin: { l: 150, r: 50, b: 120, t: 80 },
      xaxis: {
        side: 'bottom',
        tickangle: -45,
        tickfont: { size: 10 },
        automargin: true
      },
      yaxis: {
        tickfont: { size: 10 },
        automargin: true
      },
      annotations: annotations
    };

    Plotly.newPlot('heatmap-chart5', [{
      z: z,
      x: dermati_axis_labels,
      y: dermati_axis_labels,
      type: 'heatmap',
      colorscale: [
        [0.00, '#f0fdfb'],
        [0.25, '#a9eee2'],
        [0.50, '#63dfc9'],
        [0.75, '#1dd0b0'],
        [1.00, '#04c394']
      ],
      showscale: true,
      zauto: true,
      zmin: -1,
      zmax: 1
    }], layout);
  }

  document.addEventListener("DOMContentLoaded", function () {
    updateHeatmap5('dermati_lag0');
    document.getElementById("dermatiLagSelector").addEventListener("change", function () {
      updateHeatmap5(this.value);
    });
  });
</script>



<!-- [7] pollutant-bar-chart: 오염물질 선택에 따른 바차트 전환 -->
<script>
  const pollutantCorrData = {{ pollutant_corr | tojson | safe }};

  function drawPollutantBar(pollutant) {
    const data = pollutantCorrData[pollutant];
    const trace = {
      x: Object.keys(data),
      y: Object.values(data),
      type: 'bar',
      marker: { color: '#1dd0b0' },
      text: Object.values(data).map(v => v.toFixed(3)),
      textposition: 'auto'
    };

    const layout = {
      title: pollutant + ' vs 질병별 상관계수 (lag1 기준)',
      yaxis: { title: '상관계수 (r)', range: [-0.05, 0.5] },
      xaxis: { title: '질병명' },
      margin: { l: 80, r: 40, b: 70, t: 60 }
    };

    Plotly.react('bar-corr-chart', [trace], layout);
  }

  // checkbox를 radio처럼 동작하게 (단일 선택 유지)
  const checkboxes = document.querySelectorAll('input[name="pollutantToggle"]');
  drawPollutantBar(checkboxes[0].value);  // 초기 렌더링

  checkboxes.forEach(box => {
    box.addEventListener('change', function () {
      checkboxes.forEach(b => { if (b !== this) b.checked = false; });
      if (this.checked) {
        drawPollutantBar(this.value);
      } else {
        this.checked = true;
      }
    });
  });
</script>

<!-- [8] Boxplot 차트 (Plotly) -->
<script>
  const groupedBoxplot = {{ grouped_boxplot | tojson | safe }};
  const boxTraces = Object.entries(groupedBoxplot).map(([label, yVals]) => ({
    y: yVals.map(Number),
    name: label,
    type: 'box',
    marker: { color: '#04C394' },
    boxpoints: 'outliers',  // 이상치 자동 표시
    line: { width: 1.5 },
    boxmean: false
  }));

  const boxplotLayout = {
  title: {
    text: '감기 vs NO₂ (Outlier만 표시한 Boxplot)',
    font: { size: 16 }
  },
  boxmode: 'overlay',
  yaxis: {
    title: {
      text: '감기 발생건수',
      font: { size: 14 }
    }
  },
  xaxis: {
    title: '농도 구간',
    categoryorder: 'array',
    categoryarray: ['낮음', '중간', '높음']
  },
  margin: { l: 60, r: 40, t: 60, b: 60 }
};

Plotly.newPlot('boxplot-chart1', boxTraces, boxplotLayout);

</script>


  
</body>


{% endblock %}




</html>